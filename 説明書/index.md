# ASC Simulator&Assemblerの説明書
ASC Simulator&Assemblerは、**ASC(A Simple Computer)**の*アセンブラ*とシミュレータのセットです。
この説明書では、ASC AssemblerとASC Simulatorの使い方の説明と、アセンブリファイルの仕様について説明します。

> #### アセンブラとは？
> アセンブラとは、コンピュータが実行できる0と1の羅列が、人間にはわかりづらいものであるため、考えられたものです。機械語をわかりやすく表現することで、プログラム作成の負担を軽減します。
>

# ASC Assembler
ASC Assemblerは、"asc-assembler.exe"というファイル名で配布しています。
このexeファイルは、.ascs形式で記述されたソースコードを読み込み、アセンブル時のログと共にシミュレータの読む込むことのできる.ascoファイルを書き出すことができます。

## 主な使い方
まず、ascs形式のソースコードを用意します。文法については後述します。
用意したソースコードをasc-assembler.exeに読み込ませます。以下の様に入力してEnterキーを押して下さい。
```
asc-assembler.exe 用意したソースコード.ascs
```

もしくは、インストール時にデスクトップに生成された、"asc-assembler"というリンクに.ascsファイルをドラッグアンドドロップすることでも、アセンブルを実行することができます。

[警告][エラー]などの表示が出なければアセンブル成功です。

成功時には、*アセンブル*のログが表示され、ソースコードと同じディレクトリに.ascoファイルを出力します。
この.ascoファイルが、オブジェクトファイルになり、シミュレータに実行させることができます。

> #### アセンブルとは？
> アセンブリ言語によって記述されたプログラムを、機械語に変換する作業のことをいいます。
> #### コマンドプロンプトとは？
> テキストベースのプログラムを扱うことができる、Windowsに付属のツールのことです。Macでは"ターミナル", Unix系では"コンソール"などとも呼ばれています。

# ASC Simulator
ASC Assemblerで作成したオブジェクトファイルを実行することができるシミュレータです。
使い方については、asc-simulator.exeをダブルクリックして、メニューバーの[ヘルプ]より、[使い方]を参照してください。

# .ascsファイルについて
.ascsファイルは、ASCに実行させたい命令を順番に記述したファイルです。書式には、独自のASCアセンブリ言語を用いていて、以下にその書式を示します。

## ASCアセンブリ言語の書式
### ラベル

ラベルとは、命令につけた名札です。この名札があることによって、ユーザはアドレスを意識すること無くソースコードを作成することができるようになります。
具体的には、以下のようにラベルを記述します。
```
Label1  LD Label2
        ADD 0x1
Label2  B  Label1
```
この場合、Label1とLabel2がラベル名となります。一行目のLabel1は、"LD Label2"のアドレスを指します。同様に、Label2は"B Label1"のアドレスを指します。
結果として、一行目の"LD Label2"は"B Label1"の内容をロードする、という意味になります。Label2についても同様です。
ラベル名の記述に仕方について、
1. **10文字未満であること**
2. **アルファベットから始まっていること**

が守られている必要があります。また、
1. **大文字小文字は区別される**

という点に気をつけてください。例えば、Label1とlabel1は別のものと解釈されます。

### 命令

命令は、実際にASCに実行させたい動作を指定するものです。
命令を記述する際、命令の前に空白(半角空白, 全角空白, タブ文字)が無い場合、ラベル名として扱われます。気をつけてください。
また、全ての命令は大文字のみで記述してください。小文字を混ぜて使用すると、エラーとなります。
使用できる命令は以下の10個です。

----

#### 1. LD <16進数>または<ラベル名>

指定したアドレスからレジスタRへ値をロードする命令です。

#### 2. ST <16進数>または<ラベル名>

指定したアドレスへレジスタRから値をストアする命令です。

#### 3. ADD <16進数>または<ラベル名>

指定したアドレスの値をレジスタRの値に加算する命令です。
もし、演算の結果レジスタRの値が負になった場合、フラグNが立ちます。
もし、演算の結果レジスタRの値が0になった場合、フラグZが立ちます。
もし、正の値+正の値の演算により、レジスタRの値が負の値になった場合、オーバフローとなります。
もし、負の値+負の値の演算により、レジスタRの値が正の値になった場合、オーバフローとなります。

#### 4. SUB <16進数>または<ラベル名>

レジスタRの値から指定したアドレスの値を減算する命令です。
もし、演算の結果レジスタRの値が負になった場合、フラグNが立ちます。
もし、演算の結果レジスタRの値が0になった場合、フラグZが立ちます。
もし、正の値-負の値の演算により、レジスタRの値が負の値になった場合、オーバフローとなります。
もし、負の値-正の値の演算により、レジスタRの値が正の値になった場合、オーバフローとなります。

#### 5. AND <16進数>または<ラベル名>

レジスタRの値と指定したアドレスの値の論理積を取ります。
もし、演算の結果レジスタRの値が0になった場合、フラグZが立ちます。

#### 6. OR <16進数>または<ラベル名>

レジスタRの値と指定したアドレスの値の論理和を取ります。
もし、演算の結果レジスタRの値が0になった場合、フラグZが立ちます。

#### 7. B <16進数>または<ラベル名>

指定したアドレスへ処理を移します。
具体的には、MARの値をPCへ移動します。

#### 8. BZ <16進数>または<ラベル名>

Zフラグが立っていた場合、指定したアドレスへ処理を移します。
具体的には、IRのオペランド部の値をPCへ移動します。

#### 9. BN <16進数>または<ラベル名>

Nフラグが立っていた場合、指定したアドレスへ処理を移します。
具体的には、IRのオペランド部の値をPCへ移動します。

#### 10. HLT

ASCを停止します。この命令にはオペランドは必要ありません。

---

### 擬似命令
前述の命令はASCに対する命令であったのに対し、擬似命令はアセンブラに対する動作を指定するものです。
擬似命令には以下の5つがあります。

#### 1. TITLE <名前>
プログラムのタイトルを指定します。
ここで指定された名前に.ascoを付加したものを、オブジェクトファイル名として使用します。

#### 2. ORG <16進数>
プログラムの先頭アドレスを指定します。
シミュレーション開始時には、ORGで宣言したアドレスをPCにセットします。
また、ORGが省略された場合には、0x0000番地を使用します。


#### 3. DC <符号付き数>
定数を定義します。

#### 4. DS <10進数>
指定したサイズのメモリ領域を確保します。

#### 5. END
プログラムの終了を表します。これ以降に記述されたプログラムは無視します。

----

### オペランド

命令の操作対象をオペランドと呼びます。命令の隣に記述します。
ASCアセンブリ言語では、16進数、10進数、符号付き10進数、名前をオペランドとして扱うことができます。

### コメント

ASCアセンブリ言語は、";"(セミコロン)の後の文字を全て無視します。よって、セミコロンの後にプログラムの説明を書くことができます。これをコメントと呼びます。
コメントは主に、セミコロンが行頭にくる一行コメントと、セミコロンが行末にくる行末コメントに分けられます。
行頭コメントの場合、アセンブルのログでは一行全てをコメントとして表示します。

```
; 一行コメントの例

Test   LD 0x10 ;行末コメントの例

```

## ASCアセンブリ言語の言語仕様
以下に、BNF記法でこの言語の仕様を記述します。

```
<プログラム> ::=
 <プログラム頭部>
 <プログラム本体>
 <プログラム後部>

<プログラム頭部> ::= TITLE <名前> { ORG <16進数> }

<プログラム本体> ::= <命令>{ <命令> }
<命令> ::= <ラベル> <命令本体> { <コメント> } | <命令本体> { <コメント> } | <コメント>
<ラベル> ::= <名前>
<コメント> ::= ;すべての文字

<命令本体> ::= <命令グループ1> | <命令グループ2> | <命令グループ3>
<命令グループ1> ::= <OP1> <16進数> | <OP1> <ラベル>
<OP1> ::= LD | ST | ADD | SUB | AND | OR | B | BZ | BN
<命令グループ2> ::= HLT
<命令グループ3> ::= DC <符号付き数> | DS <数値>

<符号付き数> ::= <10進数> | +<10進数> | -<10進数>
<数値> ::= <10進数>
<名前> ::= <アルファベット> {<アルファベットまたは数字>}

<16進数> ::= 0x<10進数>|A|B|C|D|E|F{<10進数>|A|B|C|D|E|F}
<10進数> ::= <数字>
<アルファベットまたは数字> ::= <数字> | <アルファベット>
<数字> ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9

<文字> ::= | ! | “ | # | $ | % | & | ’ | ( | ) | - | = | ^ | \ | | |
     @ | ` | [ | { | ; | + | : | * | ] | } | , | < | . | > | / | ? | _ |
    <アルファベット>
<アルファベット> ::= A | B | C | D | E | F | … | X | Y | Z |
                   a | b | c | d | e | f | … | x | y | z |

<プログラム後部> ::= END
```
